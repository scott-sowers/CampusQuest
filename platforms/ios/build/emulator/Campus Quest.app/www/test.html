<!doctype html>
<html ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <title>Untitled Document</title>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
    <script src="js/angular-apimock.js"></script>
</head>
<body>
    <div ng-controller="HomeCtrl">
        <h1>Team Before</h1>
        <pre>{{teamBefore | json }}</pre>
        <h1>Team After</h1>
        <pre>{{teamAfter | json }}</pre>
    </div>
<script>
var app = angular.module('myApp', ['apiMock']);
    
app.config(function ($httpProvider, httpInterceptorProvider) {
    // Set default headers for CORS usage
    $httpProvider.defaults.useXDomain = true;
    delete $httpProvider.defaults.headers.common['X-Requested-With'];
    $httpProvider.defaults.headers.post["Content-Type"] = "application/x-www-form-urlencoded";
    $httpProvider.defaults.headers.put = {"Content-Type": "text/plain;charset=UTF-8"};
    
    httpInterceptorProvider.config({
        mockDataPath: '/mock_data',
        apiPath: 'http://ec2-54-201-182-243.us-west-2.compute.amazonaws.com:18080/api'
    });
});

app.factory('QuestApi', function($http) {
    var _baseUrl = 'http://ec2-54-201-182-243.us-west-2.compute.amazonaws.com:18080/api';
    var _doRequest = function(method, urlParams) {
        var data = arguments[2] || '';
        return $http({
            method: method,
            url: _baseUrl + '/' + urlParams,
            data: data
        });
    };
    
    return {
        getEventByCode: function(eventCode) {
            return _doRequest('GET', 'event/retrieve/code/' + eventCode);
        },
        addTeamToEvent: function(eventId, teamName) {
            var data = [{
                name: teamName,
                point: 0,
                events: [{
                    id: eventId
                }]
            }];
            return _doRequest('POST', 'team/add', data);
        },
        addTeamAchievement: function(teamId, achievementId, photoUrl) {
            var data = [{
                team: teamId,
                achievement: achievementId,
                picture: photoUrl
            }];
            return _doRequest('POST', 'teamachievement/add', data);
        },
        editTeamAchievement: function(teamId, achievementId, photoUrl) {
            var data = [{
                team: teamId,
                achievement: achievementId,
                picture: photoUrl
            }];
            return _doRequest('PUT', 'teamachievement/edit', data);
        },
        getTeamByName: function(teamName) {
            return _doRequest('GET', 'team/retrieve/name/' + teamName); 
        }
    };
});

app.controller('HomeCtrl', function($scope,QuestApi) {
    QuestApi.getEventByCode('B7HU1').success(function(data) {
        $scope.teamBefore = data;
    });
    
    /*QuestApi.addTeamToEvent(1,'Team Scott').success(function(data) {
        $scope.teamBefore = data; 
    });*/
    
    var photoUrl1 = 'https://onedrive.live.com/redir?resid=2E3C33E1DCCD09BB!2969&authkey=!AIt9TnnN0KyusKA&v=3&ithint=photo%2c.jpg';
    var photoUrl2 = 'https://onedrive.live.com/redir?resid=2E3C33E1DCCD09BB!5302&authkey=!AJRd06xk5jHj3Bs&v=3&ithint=photo%2c.jpg';
    /*QuestApi.addTeamAchievement(338,2,photoUrl1).success(function(data) {
       $scope.teamAfter = data;
    });*/
    
    /*QuestApi.getTeamByName("Team Scott").success(function(data) {
       $scope.teamBefore = data; 
    });*/
    
    /*QuestApi.editTeamAchievement(338,1,photoUrl2).success(function(data) {
       $scope.teamAfter = data; 
    });*/
});
</script>
</body>
</html>